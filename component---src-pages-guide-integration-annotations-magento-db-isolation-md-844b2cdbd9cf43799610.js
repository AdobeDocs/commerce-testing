"use strict";(self.webpackChunkcommerce_testing=self.webpackChunkcommerce_testing||[]).push([[9781],{19249:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return d},default:function(){return m}});var n=a(87462),s=a(63366),o=(a(15007),a(64983)),l=a(91515),i=["components"],d={},r={_frontmatter:d},c=l.Z;function m(e){var t=e.components,a=(0,s.Z)(e,i);return(0,o.mdx)(c,(0,n.Z)({},r,a,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"database-isolation-annotation"},"Database isolation annotation"),(0,o.mdx)("p",null,"To isolate database changes between tests, the Integration testing framework (ITF) implements the ",(0,o.mdx)("inlineCode",{parentName:"p"},"@magentoDbIsolation")," annotation."),(0,o.mdx)("p",null,"When the ",(0,o.mdx)("inlineCode",{parentName:"p"},"@magentoDbIsolation")," is enabled, the ITF:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"starts a database transaction before the test/test case."),(0,o.mdx)("li",{parentName:"ul"},"avoids a database commit during the test/test case."),(0,o.mdx)("li",{parentName:"ul"},"restores the database after the test/test case.")),(0,o.mdx)("h2",{id:"format"},"Format"),(0,o.mdx)("p",null,"Database isolation annotation:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-php?start_inline=1"},"/**\n * @magentoDbIsolation enabled|disabled\n */\n")),(0,o.mdx)("h2",{id:"test-case-declaration"},"Test case declaration"),(0,o.mdx)("p",null,"Use test case declarations when a sequence of tests introduces changes to the database and relies on the changes made by each other.\nFor example, typical CRUD tests: ",(0,o.mdx)("em",{parentName:"p"},"create -> read -> update -> delete"),".\nEvery next test relies on a database state after the previous one.\nIf at any point of that sequence (after creation) the test fails, the database will be polluted with test data.\nTo apply a database rollback after the test case, create a separate test case with ",(0,o.mdx)("inlineCode",{parentName:"p"},"@magentoDbIsolation")," enabled at a class level."),(0,o.mdx)("p",null,"Example:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-php?start_inline=1"},"/**\n * @magentoDbIsolation enabled\n */\nclass Some\\EntityTest extends \\PHPUnit\\Framework\\TestCase\n{\n    public function testCreate()\n    {\n        $this->object->setData($this->initialData)->save();\n        $this->assertNotEmpty($this->object->getId());\n        return $this->object->getId();\n    }\n\n    public function testRead($objectId)\n    {\n        $this->object->load($objectId);\n        $this->assertEquals($this->initialData, $this->object->getData());\n        return $objectId;\n    }\n\n    public function testUpdate($objectId)\n    {\n        $this->object->setData($newData)->save();\n        $object = new Some_Entity();\n        $object->load($objectId);\n        $this->assertEquals($newData, $object->getData());\n        return $objectId;\n    }\n\n    public function testDelete($objectId)\n    {\n        $this->object->delete();\n        $object = new Some_Entity();\n        $object->load($objectId);\n        $this->assertEmpty($object->getData());\n    }\n}\n")),(0,o.mdx)("h2",{id:"test-declaration"},"Test declaration"),(0,o.mdx)("p",null,"To isolate changes made to database by a single test, enable the ",(0,o.mdx)("inlineCode",{parentName:"p"},"@magentoDbIsolation")," for the test."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-php?start_inline=1"},"/**\n* @magentoDbIsolation enabled\n*/\npublic function testSave()\n{\n    $taxClassDataObject = $this->taxClassFactory->create();\n    $taxClassDataObject->setClassName(self::SAMPLE_TAX_CLASS_NAME)\n        ->setClassType(TaxClassManagementInterface::TYPE_CUSTOMER);\n    $taxClassId = $this->taxClassRepository->save($taxClassDataObject);\n    $this->assertEquals(self::SAMPLE_TAX_CLASS_NAME, $this->taxClassModel->load($taxClassId)->getClassName());\n}\n")))}m.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guide-integration-annotations-magento-db-isolation-md-844b2cdbd9cf43799610.js.map