"use strict";(self.webpackChunkcommerce_testing=self.webpackChunkcommerce_testing||[]).push([[3800],{77292:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return d},default:function(){return u}});var o=t(58168),a=t(80045),r=(t(88763),t(15680)),i=t(83407);const m=["components"],d={},s=(l="InlineAlert",function(e){return console.warn("Component "+l+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.mdx)("div",e)});var l;const p={_frontmatter:d},c=i.A;function u(e){let{components:n}=e,t=(0,a.A)(e,m);return(0,r.mdx)(c,(0,o.A)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"configuring-two-factor-authentication-2fa"},"Configuring two-factor authentication (2FA)"),(0,r.mdx)("p",null,"Using two-factor authentication (2FA) with the Functional Testing Framework is possible with some configurations settings in Magento.\nIn this document, we will use Google as the authentication provider."),(0,r.mdx)("h2",{id:"configure-magento"},"Configure Magento"),(0,r.mdx)("p",null,"To prepare Adobe Commerce or Magento Open Source for testing when 2FA is enabled, set the following configurations through the Adobe Commerce or Magento Open Source CLI."),(0,r.mdx)("p",null,"First, select ",(0,r.mdx)("inlineCode",{parentName:"p"},"Google Authenticator")," as Magento's 2FA provider:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set twofactorauth/general/force_providers google\n")),(0,r.mdx)("p",null,"Now set the OTP window to ",(0,r.mdx)("inlineCode",{parentName:"p"},"29"),":"),(0,r.mdx)(s,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"In ",(0,r.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-operations/release/notes/adobe-commerce/2-4-7.html"},"2.4.7")," and later, the OTP window configuration setting controls how long (in seconds) the system accepts an administrator's one-time-password (OTP) after it has expired. This value must be less than 30 seconds. The system default is also changed to ",(0,r.mdx)("inlineCode",{parentName:"p"},"29"),"."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set twofactorauth/google/leeway 29\n")),(0,r.mdx)("p",null,"Set a base32-encoded ",(0,r.mdx)("inlineCode",{parentName:"p"},"secret")," for ",(0,r.mdx)("inlineCode",{parentName:"p"},"Google Authenticator")," to generate a OTP for the default admin user that you set for ",(0,r.mdx)("inlineCode",{parentName:"p"},"MAGENTO_ADMIN_USERNAME")," in ",(0,r.mdx)("inlineCode",{parentName:"p"},".env"),":"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento security:tfa:google:set-secret <MAGENTO_ADMIN_USERNAME> <OTP_SHARED_SECRET>  \n")),(0,r.mdx)("h2",{id:"configure-the-mftf"},"Configure the MFTF"),(0,r.mdx)("p",null,"Save the same base32-encoded ",(0,r.mdx)("inlineCode",{parentName:"p"},"secret")," in the Functional Testing Framework credential storage, e.g. ",(0,r.mdx)("inlineCode",{parentName:"p"},".credentials")," file, ",(0,r.mdx)("inlineCode",{parentName:"p"},"HashiCorp Vault")," or ",(0,r.mdx)("inlineCode",{parentName:"p"},"AWS Secrets Manager"),".\nMore details are ",(0,r.mdx)("a",{parentName:"p",href:"./credentials.md"},"here"),"."),(0,r.mdx)("p",null,"The path of the ",(0,r.mdx)("inlineCode",{parentName:"p"},"secret")," should be:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-conf"},"magento/tfa/OTP_SHARED_SECRET\n")),(0,r.mdx)("h2",{id:"getotp"},"GetOTP"),(0,r.mdx)("p",null,"A one-time password (OTP) is required when an admin user logs into the Admin.\nUse the action ",(0,r.mdx)("inlineCode",{parentName:"p"},"getOTP")," ",(0,r.mdx)("a",{parentName:"p",href:"./test/actions.md#getotp"},"Reference")," to generate the code and use it for the ",(0,r.mdx)("inlineCode",{parentName:"p"},"Authenticator code")," text field in 2FA - Google Auth page."),(0,r.mdx)("p",null,"Note:\nYou will need to set the ",(0,r.mdx)("inlineCode",{parentName:"p"},"secret")," for any non-default admin users first, before using ",(0,r.mdx)("inlineCode",{parentName:"p"},"getOTP"),". For example:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-xml"},'<magentoCLI command="security:tfa:google:set-secret admin2 {{_CREDS.magento/tfa/OTP_SHARED_SECRET}}" stepKey="setSecret"/>\n')))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-functional-testing-framework-two-factor-authentication-md-7a8f13b68f0a76aad028.js.map